/// <reference path='babylon.module.d.ts' /> 

// cibler le canvas
const canvas = document.getElementById('renderCanvas')

//creer un enin babylon
const engine = new BABYLON.Engine(canvas, true)

function createScene() {

    //Scene
    const scene = new BABYLON.Scene(engine)
    scene.gravity = new BABYLON.Vector3(0, -9.81, 0)
    scene.collisionsEnabled = true

    //Camera
    let camera = new BABYLON.FreeCamera('MainCamera', new BABYLON.Vector3(0, 2.5, 5), scene)
    camera.applyGravity = true
    camera.checkCollisions = true

    camera.speed = 0.5
    camera.angularSensibility = 1000

    const z = camera.keysUp = [90] //Z
    const q = camera.keysLeft = [81] //Q
    const s = camera.keysDown = [83] //S
    const d = camera.keysRight = [68] //D

    scene.activeCamera.attachControl(canvas)

    //lumiere
    let light = new BABYLON.PointLight("DirLight", new BABYLON.Vector3(0, 10, 0), scene)
    light.diffuse = new BABYLON.Color3(1, 1, 1)
    light.specular = new  BABYLON.Color3(0.6, 0.6, 0.6)
    light.intensity = 1.5

    //sol
    let ground = BABYLON.Mesh.CreatePlane("ground", 50, scene)
    ground.rotation.x = Math.PI / 2
    ground.checkCollisions = true
    ground.material = new BABYLON.StandardMaterial("gMaterial", scene)

    ground.material.diffuseTexture = new BABYLON.Texture("../assets/images/pave.webp", scene)
    ground.material.diffuseTexture.uScale = 30
    ground.material.diffuseTexture.vScale = 30


    //boite
    let boxMaterial = new BABYLON.StandardMaterial("bMaterial", scene)
    boxMaterial.diffuseTexture = new BABYLON.Texture("../assets/images/bois.jpg", scene)
    const cubeSize = 2
    for (var i = 0; i<10 ; i++)
    {
        let box = BABYLON.Mesh.CreateBox("box", cubeSize, scene )
        const randomX = Math.floor(Math.random() * 31) - 15
        const randomZ = Math.floor(Math.random() * 31) - 15
        box.position = new BABYLON.Vector3(randomX,cubeSize/2, randomZ)
        box.checkCollisions = true

        box.material = boxMaterial
    }
    return scene

}

//creer notre scene 
const scene = createScene()

engine.runRenderLoop(()=>{
    scene.render()
})